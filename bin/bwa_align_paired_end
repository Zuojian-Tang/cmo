#!/opt/common/CentOS_6-dev/python/python-2.7.10/bin/python

import argparse, os, sys, re, subprocess,itertools
import tempfile
import mskcmo

if __name__ =='__main__':
    parser = argparse.ArgumentParser(description="run bwa on paired end reads")
    parser.add_argument("--genome", choices=mskcmo.util.genomes.keys(), required=True)
    parser.add_argument("--version", choices=mskcmo.util.programs['bwa'].keys(), required=True)
    parser.add_argument("--fastq1", required=True)
    parser.add_argument("--fastq2", required=True)
    parser.add_argument("--tmp", default="/tmp/")
    parser.add_argument("--output-bam", required=True)
    args = parser.parse_args()
    bwa_helper = mskcmo.bwa.Bwa(version=args.version)
    fasta = mskcmo.util.genomes['hg19']['fasta']
    sai1 = tempfile.NamedTemporaryFile(dir=args.tmp, delete=False)
    sai1.close()
    sai2 = tempfile.NamedTemporaryFile(dir=args.tmp, delete=False)
    print bwa_helper.aln(fasta, args.fastq1, sai1.name, {'t':'4'})
    print bwa_helper.aln(fasta, args.fastq2, sai2.name, {'t':'4'})
    print bwa_helper.sampe(fasta, sai1.name, sai2.name, args.fastq1, args.fastq2, args.output_bam, None)
